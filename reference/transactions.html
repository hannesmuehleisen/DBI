<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Begin/commit/rollback SQL transactions — transactions • DBI</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
  
  
<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">DBI</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/backend.html">Implementing a new backend</a>
    </li>
    <li>
      <a href="../articles/DBI-1.html">A Common Database Interface (DBI)</a>
    </li>
    <li>
      <a href="../articles/DBI-proposal.html">A Common Interface to Relational Databases from R and S -- A Proposal</a>
    </li>
    <li>
      <a href="../articles/spec.html">DBI specification</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Begin/commit/rollback SQL transactions</h1>
    </div>

    
    <p>A transaction encapsulates several SQL statements in an atomic unit.
It is initiated with <code>dbBegin()</code> and either made persistent with <code>dbCommit()</code>
or undone with <code>dbRollback()</code>.
In any case, the DBMS guarantees that either all or none of the statements
have a permanent effect.
This helps ensuring consistency of write operations to multiple tables.</p>
    

    <pre class="usage"><span class='fu'>dbBegin</span>(<span class='no'>conn</span>, <span class='no'>...</span>)

<span class='fu'>dbCommit</span>(<span class='no'>conn</span>, <span class='no'>...</span>)

<span class='fu'>dbRollback</span>(<span class='no'>conn</span>, <span class='no'>...</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>conn</th>
      <td><p>A <a href='DBIConnection-class.html'>DBIConnection</a> object, as returned by
<code><a href='dbConnect.html'>dbConnect()</a></code>.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Other parameters passed on to methods.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p><code>dbBegin()</code>, <code>dbCommit()</code> and <code>dbRollback()</code> return <code>TRUE</code>, invisibly.
The implementations are expected to raise an error in case of failure,
but this is not tested.
In any way, all generics throw an error with a closed
or invalid connection.
In addition, a call to <code>dbCommit()</code>
or <code>dbRollback()</code>
without a prior call to <code>dbBegin()</code> raises an error.
Nested transactions are not supported by DBI,
an attempt to call <code>dbBegin()</code> twice
yields an error.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Not all database engines implement transaction management, in which case
these methods should not be implemented for the specific
<a href='DBIConnection-class.html'>DBIConnection</a> subclass.</p>
    
    <h2 class="hasAnchor" id="specification"><a class="anchor" href="#specification"></a>Specification</h2>

    
    <p>Actual support for transactions may vary between backends.
A transaction is initiated by a call to <code>dbBegin()</code>
and committed by a call to <code>dbCommit()</code>.
Data written in a transaction must persist after the transaction is committed.
For example, a table that is missing when the transaction is started
but is created
and populated during the transaction
must exist and contain the data added there
both during
and after the transaction,
and also in a new connection.</p>
<p>A transaction
can also be aborted with <code>dbRollback()</code>.
All data written in such a transaction must be removed after the
transaction is rolled back.
For example, a table that is missing when the transaction is started
but is created during the transaction
must not exist anymore after the rollback.</p>
<p>Disconnection from a connection with an open transaction
effectively rolls back the transaction.
All data written in such a transaction must be removed after the
transaction is rolled back.</p>
<p>The behavior is not specified if other arguments are passed to these
functions. In particular, <span class="pkg">RSQLite</span> issues named transactions
with support for nesting
if the <code>name</code> argument is set.</p>
<p>The transaction isolation level is not specified by DBI.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <p>Self-contained transactions: <code><a href='dbWithTransaction.html'>dbWithTransaction()</a></code></p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='no'>con</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='dbConnect.html'>dbConnect</a></span>(<span class='kw pkg'>RSQLite</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/RSQLite/topics/SQLite'>SQLite</a></span>(), <span class='st'>":memory:"</span>)

<span class='fu'><a href='dbWriteTable.html'>dbWriteTable</a></span>(<span class='no'>con</span>, <span class='st'>"cash"</span>, <span class='fu'>data.frame</span>(<span class='kw'>amount</span> <span class='kw'>=</span> <span class='fl'>100</span>))
<span class='fu'><a href='dbWriteTable.html'>dbWriteTable</a></span>(<span class='no'>con</span>, <span class='st'>"account"</span>, <span class='fu'>data.frame</span>(<span class='kw'>amount</span> <span class='kw'>=</span> <span class='fl'>2000</span>))

<span class='co'># All operations are carried out as logical unit:</span>
<span class='fu'>dbBegin</span>(<span class='no'>con</span>)
<span class='no'>withdrawal</span> <span class='kw'>&lt;-</span> <span class='fl'>300</span>
<span class='fu'><a href='dbExecute.html'>dbExecute</a></span>(<span class='no'>con</span>, <span class='st'>"UPDATE cash SET amount = amount + ?"</span>, <span class='fu'>list</span>(<span class='no'>withdrawal</span>))</div><div class='output co'>#&gt; [1] 1</div><div class='input'><span class='fu'><a href='dbExecute.html'>dbExecute</a></span>(<span class='no'>con</span>, <span class='st'>"UPDATE account SET amount = amount - ?"</span>, <span class='fu'>list</span>(<span class='no'>withdrawal</span>))</div><div class='output co'>#&gt; [1] 1</div><div class='input'><span class='fu'>dbCommit</span>(<span class='no'>con</span>)

<span class='fu'><a href='dbReadTable.html'>dbReadTable</a></span>(<span class='no'>con</span>, <span class='st'>"cash"</span>)</div><div class='output co'>#&gt;   amount
#&gt; 1    400</div><div class='input'><span class='fu'><a href='dbReadTable.html'>dbReadTable</a></span>(<span class='no'>con</span>, <span class='st'>"account"</span>)</div><div class='output co'>#&gt;   amount
#&gt; 1   1700</div><div class='input'>
<span class='co'># Rolling back after detecting negative value on account:</span>
<span class='fu'>dbBegin</span>(<span class='no'>con</span>)
<span class='no'>withdrawal</span> <span class='kw'>&lt;-</span> <span class='fl'>5000</span>
<span class='fu'><a href='dbExecute.html'>dbExecute</a></span>(<span class='no'>con</span>, <span class='st'>"UPDATE cash SET amount = amount + ?"</span>, <span class='fu'>list</span>(<span class='no'>withdrawal</span>))</div><div class='output co'>#&gt; [1] 1</div><div class='input'><span class='fu'><a href='dbExecute.html'>dbExecute</a></span>(<span class='no'>con</span>, <span class='st'>"UPDATE account SET amount = amount - ?"</span>, <span class='fu'>list</span>(<span class='no'>withdrawal</span>))</div><div class='output co'>#&gt; [1] 1</div><div class='input'><span class='kw'>if</span> (<span class='fu'><a href='dbReadTable.html'>dbReadTable</a></span>(<span class='no'>con</span>, <span class='st'>"account"</span>)$<span class='no'>amount</span> <span class='kw'>&gt;=</span> <span class='fl'>0</span>) {
  <span class='fu'>dbCommit</span>(<span class='no'>con</span>)
} <span class='kw'>else</span> {
  <span class='fu'>dbRollback</span>(<span class='no'>con</span>)
}

<span class='fu'><a href='dbReadTable.html'>dbReadTable</a></span>(<span class='no'>con</span>, <span class='st'>"cash"</span>)</div><div class='output co'>#&gt;   amount
#&gt; 1    400</div><div class='input'><span class='fu'><a href='dbReadTable.html'>dbReadTable</a></span>(<span class='no'>con</span>, <span class='st'>"account"</span>)</div><div class='output co'>#&gt;   amount
#&gt; 1   1700</div><div class='input'>
<span class='fu'><a href='dbDisconnect.html'>dbDisconnect</a></span>(<span class='no'>con</span>)</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#specification">Specification</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by R Special Interest Group on Databases (R-SIG-DB), <a href='http://hadley.nz'>Hadley Wickham</a>, Kirill Müller.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
